<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Demo</title>
  </head>
  <body>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>

<div id="container" style="position:fixed; top:160px; right:0px; width: 800px; height: 400px;"></div>
<script>
$(function () {
    var chart;
    $(document).ready(function() {
        chart_options = { 
            chart: {
                renderTo: 'container',
                type: 'line',
                marginRight: 0,
                marginBottom: 80
            },
            title: { 
                text: 'Click someone on the left'
            },
            xAxis: {
                categories: []
            },
            yAxis: {
                title: {
                    text: 'Score'
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                formatter: function() {
                    return this.x + ': ' + this.y;
                }
            },
            series: [{
            }]
        };
        chart = new Highcharts.Chart(chart_options);
   });
});
</script>



<h1>ENPS Pistol Matches</h1>
<h2>Overall Results 2006 - 2012</h2>

[% USE DBI; 
   DBI.connect("dbi:SQLite:dbname=enps.sqlite","","");
%]
<table>
   <tr>
      <th>Last name</th>
      <th>First name</th>
      <th>Total Points</th>
   </tr>
[% FOREACH user = DBI.query('select lname, fname, sum(points) points from results group by lname, fname order by sum(points) desc'); %]
   [% id = user.lname _ "_" _ user.fname; %]
   <tr id="[% id %]">
      <td>[% user.lname %]</td>
      <td>[% user.fname %]</td>
      <td>[% user.points %]</td>
      <!-- 
      [% events = [];
         nums = [];
         FOREACH result = DBI.query("select year, month, points from results where lname = '" _ user.lname _ "' and fname = '" _ user.fname _ "'order by year, month");
            events.push(result.year _ result.month);
            nums.push(result.points);
         END;
         nums.join("|");
      %]
      -->
      <script>
         $('#[% id %]').click(function() {
            chart_options.xAxis.categories = [ [% events.join(", ") %] ];
            chart_options.series = [{
                data: [ [% nums.join(", ") %] ]
            }]
            chart_options.title.text = '[% user.lname %], [% user.fname %]';
            chart = new Highcharts.Chart(chart_options);
         });
      </script>
   </tr>
[% END %]
</table>





</body>
</html>
